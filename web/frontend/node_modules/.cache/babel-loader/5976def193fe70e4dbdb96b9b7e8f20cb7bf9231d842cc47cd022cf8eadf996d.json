{"ast":null,"code":"import React,{useState,useEffect}from'react';import{Container,Row,Col,Card,Button,Form,Alert}from'react-bootstrap';import{useNavigate}from'react-router-dom';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const Plans=()=>{const[plans,setPlans]=useState([]);const[filteredPlans,setFilteredPlans]=useState([]);const[loading,setLoading]=useState(true);const[error,setError]=useState('');const[priceRange,setPriceRange]=useState({min:0,max:1000});const navigate=useNavigate();useEffect(()=>{// Fetch all available plans\nfetchPlans();},[]);// Apply price filter whenever priceRange changes\nuseEffect(()=>{if(plans.length>0){setFilteredPlans(plans.filter(plan=>plan.price>=priceRange.min&&plan.price<=priceRange.max));}},[priceRange,plans]);const fetchPlans=async()=>{setLoading(true);setError('');try{const response=await fetch('/api/plans');const data=await response.json();if(!response.ok){throw new Error(data.error||'Failed to fetch plans');}setPlans(data.plans||[]);setFilteredPlans(data.plans||[]);}catch(err){setError(err.message);}finally{setLoading(false);}};const handlePriceRangeChange=e=>{const{name,value}=e.target;setPriceRange(prev=>({...prev,[name]:parseFloat(value)}));};const handleSubscribe=planId=>{// Check if user is authenticated\nconst token=localStorage.getItem('token');if(!token){navigate('/login',{state:{redirectTo:`/plans/${planId}`}});return;}// Redirect to checkout page or process subscription\nnavigate(`/subscribe/${planId}`);};const formatFeatures=featuresString=>{if(!featuresString)return[];try{return JSON.parse(featuresString);}catch{// If not valid JSON, split by comma or return as single feature\nreturn featuresString.includes(',')?featuresString.split(',').map(f=>f.trim()):[featuresString];}};return/*#__PURE__*/_jsxs(Container,{className:\"py-5\",children:[/*#__PURE__*/_jsx(\"h1\",{className:\"text-center mb-5\",children:\"Subscription Plans\"}),error&&/*#__PURE__*/_jsx(Alert,{variant:\"danger\",children:error}),/*#__PURE__*/_jsx(Row,{className:\"mb-4\",children:/*#__PURE__*/_jsx(Col,{md:6,lg:4,children:/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsxs(Card.Body,{children:[/*#__PURE__*/_jsx(\"h5\",{children:\"Filter Plans\"}),/*#__PURE__*/_jsx(Form,{children:/*#__PURE__*/_jsxs(Form.Group,{className:\"mb-3\",children:[/*#__PURE__*/_jsx(Form.Label,{children:\"Price Range\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex align-items-center\",children:[/*#__PURE__*/_jsx(Form.Control,{type:\"number\",placeholder:\"Min\",name:\"min\",value:priceRange.min,onChange:handlePriceRangeChange,min:\"0\"}),/*#__PURE__*/_jsx(\"span\",{className:\"mx-2\",children:\"to\"}),/*#__PURE__*/_jsx(Form.Control,{type:\"number\",placeholder:\"Max\",name:\"max\",value:priceRange.max,onChange:handlePriceRangeChange,min:\"0\"})]})]})})]})})})}),loading?/*#__PURE__*/_jsx(\"div\",{className:\"text-center my-5\",children:/*#__PURE__*/_jsx(\"div\",{className:\"spinner-border\",role:\"status\",children:/*#__PURE__*/_jsx(\"span\",{className:\"visually-hidden\",children:\"Loading...\"})})}):filteredPlans.length>0?/*#__PURE__*/_jsx(Row,{children:filteredPlans.map(plan=>/*#__PURE__*/_jsx(Col,{md:4,className:\"mb-4\",children:/*#__PURE__*/_jsxs(Card,{className:\"plan-card h-100\",children:[/*#__PURE__*/_jsx(Card.Header,{as:\"h5\",className:\"bg-primary text-white\",children:plan.name}),/*#__PURE__*/_jsxs(Card.Body,{className:\"d-flex flex-column\",children:[/*#__PURE__*/_jsxs(Card.Title,{className:\"mb-3\",children:[/*#__PURE__*/_jsxs(\"span\",{className:\"display-6\",children:[\"$\",plan.price.toFixed(2)]}),/*#__PURE__*/_jsxs(\"small\",{className:\"text-muted\",children:[\" / \",plan.duration,\" days\"]})]}),/*#__PURE__*/_jsx(Card.Text,{children:plan.description}),/*#__PURE__*/_jsxs(\"div\",{className:\"mt-3 mb-4\",children:[/*#__PURE__*/_jsx(\"h6\",{children:\"Features:\"}),/*#__PURE__*/_jsx(\"ul\",{children:formatFeatures(plan.features).map((feature,index)=>/*#__PURE__*/_jsx(\"li\",{children:feature},index))})]}),/*#__PURE__*/_jsx(Button,{variant:\"primary\",onClick:()=>handleSubscribe(plan.id),className:\"mt-auto\",children:\"Subscribe\"})]})]})},plan.id))}):/*#__PURE__*/_jsx(\"div\",{className:\"text-center my-5\",children:/*#__PURE__*/_jsx(\"p\",{children:\"No subscription plans match your criteria.\"})})]});};export default Plans;","map":{"version":3,"names":["React","useState","useEffect","Container","Row","Col","Card","Button","Form","Alert","useNavigate","jsx","_jsx","jsxs","_jsxs","Plans","plans","setPlans","filteredPlans","setFilteredPlans","loading","setLoading","error","setError","priceRange","setPriceRange","min","max","navigate","fetchPlans","length","filter","plan","price","response","fetch","data","json","ok","Error","err","message","handlePriceRangeChange","e","name","value","target","prev","parseFloat","handleSubscribe","planId","token","localStorage","getItem","state","redirectTo","formatFeatures","featuresString","JSON","parse","includes","split","map","f","trim","className","children","variant","md","lg","Body","Group","Label","Control","type","placeholder","onChange","role","Header","as","Title","toFixed","duration","Text","description","features","feature","index","onClick","id"],"sources":["/Users/saneechka/ManageSubscription/web/frontend/src/pages/Plans.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { Container, Row, Col, Card, Button, Form, Alert } from 'react-bootstrap';\nimport { useNavigate } from 'react-router-dom';\n\nconst Plans = () => {\n  const [plans, setPlans] = useState([]);\n  const [filteredPlans, setFilteredPlans] = useState([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState('');\n  const [priceRange, setPriceRange] = useState({ min: 0, max: 1000 });\n  \n  const navigate = useNavigate();\n\n  useEffect(() => {\n    // Fetch all available plans\n    fetchPlans();\n  }, []);\n\n  // Apply price filter whenever priceRange changes\n  useEffect(() => {\n    if (plans.length > 0) {\n      setFilteredPlans(\n        plans.filter(plan => \n          plan.price >= priceRange.min && \n          plan.price <= priceRange.max\n        )\n      );\n    }\n  }, [priceRange, plans]);\n\n  const fetchPlans = async () => {\n    setLoading(true);\n    setError('');\n\n    try {\n      const response = await fetch('/api/plans');\n      const data = await response.json();\n\n      if (!response.ok) {\n        throw new Error(data.error || 'Failed to fetch plans');\n      }\n\n      setPlans(data.plans || []);\n      setFilteredPlans(data.plans || []);\n    } catch (err) {\n      setError(err.message);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handlePriceRangeChange = (e) => {\n    const { name, value } = e.target;\n    setPriceRange(prev => ({\n      ...prev,\n      [name]: parseFloat(value)\n    }));\n  };\n\n  const handleSubscribe = (planId) => {\n    // Check if user is authenticated\n    const token = localStorage.getItem('token');\n    \n    if (!token) {\n      navigate('/login', { state: { redirectTo: `/plans/${planId}` } });\n      return;\n    }\n\n    // Redirect to checkout page or process subscription\n    navigate(`/subscribe/${planId}`);\n  };\n\n  const formatFeatures = (featuresString) => {\n    if (!featuresString) return [];\n    \n    try {\n      return JSON.parse(featuresString);\n    } catch {\n      // If not valid JSON, split by comma or return as single feature\n      return featuresString.includes(',') \n        ? featuresString.split(',').map(f => f.trim())\n        : [featuresString];\n    }\n  };\n\n  return (\n    <Container className=\"py-5\">\n      <h1 className=\"text-center mb-5\">Subscription Plans</h1>\n\n      {error && <Alert variant=\"danger\">{error}</Alert>}\n\n      <Row className=\"mb-4\">\n        <Col md={6} lg={4}>\n          <Card>\n            <Card.Body>\n              <h5>Filter Plans</h5>\n              <Form>\n                <Form.Group className=\"mb-3\">\n                  <Form.Label>Price Range</Form.Label>\n                  <div className=\"d-flex align-items-center\">\n                    <Form.Control \n                      type=\"number\" \n                      placeholder=\"Min\" \n                      name=\"min\"\n                      value={priceRange.min}\n                      onChange={handlePriceRangeChange}\n                      min=\"0\"\n                    />\n                    <span className=\"mx-2\">to</span>\n                    <Form.Control \n                      type=\"number\" \n                      placeholder=\"Max\" \n                      name=\"max\"\n                      value={priceRange.max}\n                      onChange={handlePriceRangeChange}\n                      min=\"0\"\n                    />\n                  </div>\n                </Form.Group>\n              </Form>\n            </Card.Body>\n          </Card>\n        </Col>\n      </Row>\n\n      {loading ? (\n        <div className=\"text-center my-5\">\n          <div className=\"spinner-border\" role=\"status\">\n            <span className=\"visually-hidden\">Loading...</span>\n          </div>\n        </div>\n      ) : filteredPlans.length > 0 ? (\n        <Row>\n          {filteredPlans.map(plan => (\n            <Col md={4} key={plan.id} className=\"mb-4\">\n              <Card className=\"plan-card h-100\">\n                <Card.Header as=\"h5\" className=\"bg-primary text-white\">{plan.name}</Card.Header>\n                <Card.Body className=\"d-flex flex-column\">\n                  <Card.Title className=\"mb-3\">\n                    <span className=\"display-6\">${plan.price.toFixed(2)}</span>\n                    <small className=\"text-muted\"> / {plan.duration} days</small>\n                  </Card.Title>\n                  <Card.Text>{plan.description}</Card.Text>\n                  \n                  <div className=\"mt-3 mb-4\">\n                    <h6>Features:</h6>\n                    <ul>\n                      {formatFeatures(plan.features).map((feature, index) => (\n                        <li key={index}>{feature}</li>\n                      ))}\n                    </ul>\n                  </div>\n                  \n                  <Button \n                    variant=\"primary\" \n                    onClick={() => handleSubscribe(plan.id)}\n                    className=\"mt-auto\"\n                  >\n                    Subscribe\n                  </Button>\n                </Card.Body>\n              </Card>\n            </Col>\n          ))}\n        </Row>\n      ) : (\n        <div className=\"text-center my-5\">\n          <p>No subscription plans match your criteria.</p>\n        </div>\n      )}\n    </Container>\n  );\n};\n\nexport default Plans;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}